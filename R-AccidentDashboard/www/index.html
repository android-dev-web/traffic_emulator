<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous" />
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.js"></script>
  <script src="https://chartjs-plugin-crosshair.netlify.com/chartjs-plugin-crosshair.js"></script>
  
  <script src="shared/jquery.js" type="text/javascript"></script>
  <script src="shared/shiny.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="shared/shiny.css"/>
</head>

<body style = "background-color: #172B4D;">
  <div style="position: relative; min-height: 100vh;">
    <div style="padding-bottom: 5rem;">
      <div style="color: white; height: 7.5rem; text-align: center; padding-top: 2rem;">
        <span style="font-size: 2rem; font-weight: bolder;">Car Accident Statistics Dashboard</span>
      </div>
      <div style="margin-left: 5rem; margin-right: 5rem;">
        
        
        
        <!--show car accient counts-->
        <div class="row">
          <div 
            class="col"
            style="background-color: #fb6340; color: white; border-radius: .5rem; padding: 1rem; margin: 1rem;"
          >
            <div 
              id="crashes_status"
              class="shiny-html-output"
              style="font-size: 2rem; font-weight: bolder;"
            ></div>
            <div
              style="font-size: 1.2rem; font-weight: 500;"
            >
                Car: <span id="crashes_car" class="shiny-html-output"></span>% | Bus: <span id="crashes_bus" class="shiny-html-output"></span>% | Truck: <span id="crashes_truck" class="shiny-html-output"></span>%
            </div>
          </div>
          <div 
            class="col"
            style="background-color: #fb6340; color: white; border-radius: .5rem; padding: 1rem; margin: 1rem;"
          >
            <div 
              id="accident_status" 
              class="shiny-html-output"
              style="font-size: 2rem; font-weight: bolder;"
            ></div>
            <div 
              style="font-size: 1.2rem; font-weight: 500;"
            >
                Car: <span id="accident_car" class="shiny-html-output"></span>% | Bus: <span id="accident_bus" class="shiny-html-output"></span>% | Truck: <span id="accident_truck" class="shiny-html-output"></span>%
            </div>
          </div>
          <div 
            class="col"
            style="background-color: #fb6340; color: white; border-radius: .5rem; padding: 1rem; margin: 1rem;"
          >
            <div 
              id="injury_status" 
              class="shiny-html-output"
              style="font-size: 2rem; font-weight: bolder;"
            ></div>
            <div 
              style="font-size: 1.2rem; font-weight: 500;"
            >
                Light Injury: <span id="injury_light" class="shiny-html-output"></span> | Severe Injury: <span id="injury_severe" class="shiny-html-output"></span>
            </div>
          </div>
          
        </div>

        <!--First Map and Chart Component Section-->
        <div class="row" style="margin-top: 1rem;">
          <div class="col" 
            id="map"
            style="height: 30rem; border-color: white; border-style: solid; border-width: .5rem; border-radius: .25rem;"
          ></div>
          <div class="col">
            <div 
              style="margin-top: 2rem; margin-left: 2rem;"
            >
              <div style="text-align: center; margin-bottom: .5rem;">
                <span id="chart_title" class="shiny-html-output"></span>
              </div>
              <canvas id="barChart_1"></canvas>
            </div>
          </div>
        </div>
        
        
      </div>
    </div>
    <div style="position: absolute; bottom: 0; width: 100%; height: 5rem; color: white; text-align: center;">
      <div style="padding-top: 2rem;">
        <span style="font-size: 1rem; font-weight: 500;">Car Accident Statistics Dashboard</span>
      </div>
    </div>
  </div>

  <script>
    // add marker on map
    Shiny.addCustomMessageHandler("sendCameraPosition",
      function(posData) {
        var data = [];

        for(var i=0; i < posData.length / 2; i++){
          data.push({'lat':posData[i], 'lon': posData[i + posData.length / 2]});
        }

        // define map instance
        var map = L.map('map', {
          center: [data[0].lat,data[0].lon],
          zoom: 13.2
        });
        
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    
        data.forEach(function(row){
          var pos = new L.LatLng(row.lat,row.lon);
          var icontext = row.content;
    
          var icon = L.divIcon({
           iconSize: null,
           html:'<div class="map-label"></div>'
          });
    
          // reference marker
          L.marker(pos).addTo(map);
          L.marker(pos,{icon: icon}).addTo(map);
        });
      }
    );

    Chart.defaults.global.defaultFontColor = 'white';
    Chart.defaults.global.defaultFontSize = 18;

    Shiny.addCustomMessageHandler("sendChartData", function(data) {
      var canvas_1 = document.getElementById("barChart_1");
      var ctx_1 = canvas_1.getContext('2d');
      
      var chartLabel = [];
      var chartData = [];
      
      for(var i = 0; i < data.length / 2; i++) {
        chartLabel.push(data[i]);
      }
      
      var count = 0;
      for(var i = data.length / 2; i < data.length; i++) {
        chartData[count] = data[i];
        count++;
      }
      
      var data_1 = {
      labels: chartLabel,
      datasets: 
      [
        {
          label: "Adidas",
          backgroundColor: "#ff9900",
          hoverBorderColor: "#00000033",
          borderWidth: 2,
          borderColor: '#ff9900',
          hoverBackgroundColor: "#ff9900",
          hoverBorderWidth: 1,
          spanGaps: true,
          data: chartData,
          borderSkipped: true
        }
      ]
    };
      var options_1 = {
      hover: {
        mode: 'index',
        intersect: true
      },
      tooltips:{
        mode: 'index',
        intersect: true,
        position: 'average',
        filter: (item) => (item.value !=='NaN' && 1 * item.value > 0),
        backgroundColor:    '#202631',
        bodyFontColor:      '#fff',
        titleFontSize:      14,
        titleFontColor:     '#fff',
        bodyFontSize:       12,
        footerFontSize:     14,
        xPadding:           16,
        yPadding:           16,
        cornerRadius:       8,
        titleSpacing:       6,
        titleMarginBottom:  12,
        bodySpacing:        6,
        caretPadding:       16,    
        callbacks: {
          title: function(tooltipItem, data_1) {
            var total = 0;
            for (var i=0; i<tooltipItem.length ; i++) {
              total += (1 * tooltipItem[i].value) || 0
            }
            return [tooltipItem[0].label, total + ' Report']
            },
           label: function(tooltipItem, data_1) {
            return ' ' + data_1.datasets[tooltipItem.datasetIndex].label + ': ' + tooltipItem.value;
          }
        }
      },
      legend:{
        display: false
      },
      scales: {
        yAxes: [
          {
            ticks: {
              beginAtZero:true
            },
            stacked: true
          }
        ],
        xAxes: [
          {
            stacked: true
          }
        ]
      },
      plugins: {
        crosshair:{
            line: {
              color: '#00000099',
              width: 1,
              dashPattern: [5, 5]
            },
            zoom: {
              enabled: false
            },
            snap: {
              enabled: false
            }
        }
      }
    };
      var chart_1 = new Chart(ctx_1, {
        type: 'bar',
        data: data_1,
        options: options_1
      });
    });
  </script>
</body>
</html>